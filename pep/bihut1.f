      real*10 function BIHUT1(jd, frw)

      use iso_fortran_env, only: int32
      implicit none
 
 
c*** start of declarations inserted by spag
      real*10 ETUTF, f2, frw, s, t, UT2UT1
      integer   i, nnint, int1, int2, int3, int4, j, jd, nr
 
c*** end of declarations inserted by spag
 
 
c     forni/robertson/ash dec 1974 real*8 function bihut1
c***********includes rapid service values
c 12/10/80  final value 10/02/80  rapid service values 10/07/80-11/21/80
c           calculate a1-ut1 time from 1969 to 1977
c$$$$$period of validity to be extended when routine revised
c        second difference interpolation from 5 days interval final
c        table.  call etutf to extrapolate.
c
c        common
      include 'argfun.inc'
      include 'fcntrl.inc'
      include 'inodta.inc'
 
      real*10 tjd, k2/.29_10/
      real*10 ARGMNT
      real*10 xint(4), y1(2), y2(2)
      integer*4 intsav/-999999/
      logical*4 lxtrp/.false./, nxtrp/.false./
      data int1, int2, int3, int4/149, 348, 565, 777/
c
c$$$$$ increase dimension when table extended
      integer*2 iau(1008)
c
c
c           bureau international de l'heure
c           1969 through 1970  -(ut1-at)
c           1971 through 1977  -(ut1-tai)
c
c     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
c
c           aiut1 at 5 days interval
c
c
c        tabular points from  2440220 to  2441055 (julian day numbers)
c        (december 29,1968 to april 13,1971, 0 hr)
      integer*2 b6971(168)/ 10123, 10246, 10368, 10490, 10614, 10738,
     1 10866, 10994, 11126, 11263, 11403, 11550, 11700, 11854, 12009,
     2 12164, 12318, 12470, 12622, 12775, 12929, 13088, 13246, 13405,
     3 13562, 13714, 13861, 14003, 14140, 14276, 14410, 14544, 14673,
     4 14800, 14920, 15035, 15145, 15250, 15346, 15443, 15538, 15636,
     5 15732, 15831, 15927, 16027, 16129, 16238, 16347, 16464, 16585,
     6 16713, 16849, 16993, 17138, 17282, 17427, 17568, 17710, 17852,
     7 17996, 18142, 18290, 18437, 18583, 18725, 18869, 19012, 19157,
     8 19302, 19449, 19600, 19747, 19894, 20040, 20183, 20327, 20469,
     9 20612, 20754, 20896, 21040, 21185, 21334, 21487, 21642, 21802,
     a 21963, 22123, 22285, 22445, 22604, 22762, 22921, 23080, 23239,
     b 23397, 23553, 23709, 23861, 24009, 24153, 24291, 24424, 24552,
     c 24675, 24795, 24910, 25024, 25135, 25242, 25347, 25447, 25545,
     d 25641, 25733, 25825, 25916, 26010, 26107, 26206, 26309, 26415,
     e 26526, 26642, 26761, 26887, 27016, 27152, 27294, 27438, 27585,
     f 27733, 27885, 28038, 28191, 28344, 28496, 28648, 28798, 28944,
     g 29091, 29233, 29374, 29513, 29648, 29781, 29910,    39,   167,
     h   294,   423,   553,   684,   810,   935,  1062,  1191,  1322,
     i  1455,  1594,  1740,  1896,  2066,  2245,  2403,  2556,  2708/
c
c        tabular points from  2441060 to  2441895 (julian day numbers)
c        (april 18,1971 to july 31,1973, 0 hr)
      integer*2 b7173(168)/  2860,  3016,  3176,  3341,  3507,  3671,
     1  3831,  3987,  4137,  4282,  4424,  4561,  4691,  4813,  4928,
     2  5043,  5158,  5277,  5402,  5526,  5651,  5774,  5892,  6008,
     3  6123,  6240,  6363,  6495,  6634,  6776,  6922,  7070,  7219,
     4  7372,  7531,  7698,  7870,  8045,  8223,  8404,  8587,  8771,
     5  8953,  9133,  9306,  9475,  9641,  9796,  9940, 10080, 10215,
     6 10349, 10490, 10638, 10793, 10949, 11105, 11263, 11424, 11593,
     7 11770, 11944, 12107, 12272, 12440, 12611, 12784, 12959, 13134,
     8 13308, 13484, 13661, 13838, 14016, 14191, 14365, 14536, 14709,
     9 14884, 15057, 15226, 15392, 15553, 15710, 15861, 16006, 16145,
     a 16279, 16409, 16536, 16660, 16782, 16903, 17026, 17154, 17289,
     b 17424, 17559, 17689, 17818, 17941, 18067, 18204, 18349, 18500,
     c 18660, 18823, 18990, 19154, 19317, 19480, 19642, 19802, 19962,
     d 20122, 20285, 20451, 20619, 20788, 20956, 21120, 21283, 21444,
     e 21605, 21764, 21925, 22082, 22239, 22396, 22553, 22712, 22871,
     f 23035, 23200, 23365, 23533, 23701, 23869, 24038, 24210, 24385,
     g 24563, 24742, 24923, 25101, 25276, 25449, 25620, 25791, 25960,
     h 26129, 26295, 26458, 26616, 26773, 26926, 27076, 27223, 27366,
     i 27502, 27631, 27754, 27869, 27984, 28099, 28217, 28336, 28459/
c
c        tabular points from  2441900 to  2442735 (julian day numbers)
c        (august 5,1973 to november 18, 1975, 0 hr)
      integer*2 b7375(168)/ 28583, 28706, 28831, 28958, 29087, 29219,
     1 29355, 29495, 29640, 29787, 29937,    89,   243,   398,   554,
     2   714,   876,  1039,  1205,  1371,  1536,  1703,  1866,  2027,
     3  2185,  2343,  2498,  2649,  2796,  2930,  3041,  3165,  3307,
     4  3443,  3557,  3671,  3804,  3947,  4090,  4224,  4355,  4494,
     5  4644,  4801,  4964,  5124,  5276,  5422,  5567,  5711,  5861,
     6  6024,  6198,  6374,  6544,  6705,  6861,  7010,  7160,  7312,
     7  7458,  7592,  7714,  7824,  7927,  8029,  8131,  8237,  8343,
     8  8446,  8544,  8639,  8733,  8834,  8947,  9068,  9188,  9303,
     9  9412,  9524,  9645,  9772,  9905, 10041, 10176, 10312, 10456,
     a 10610, 10767, 10924, 11079, 11232, 11384, 11537, 11691, 11845,
     b 11998, 12151, 12298, 12437, 12569, 12700, 12829, 12961, 13094,
     c 13227, 13363, 13500, 13642, 13790, 13937, 14083, 14228, 14372,
     d 14513, 14651, 14793, 14937, 15086, 15241, 15400, 15555, 15703,
     e 15847, 15993, 16143, 16296, 16448, 16598, 16744, 16884, 17021,
     f 17154, 17282, 17407, 17530, 17650, 17768, 17881, 17987, 18087,
     g 18185, 18280, 18372, 18463, 18558, 18657, 18763, 18872, 18981,
     h 19088, 19196, 19311, 19430, 19552, 19676, 19805, 19940, 20079,
     i 20225, 20375, 20531, 20689, 20849, 21009, 21170, 21330, 21488/
c        tabular points from  2442740  to  2443575 (julian day numbers)
c        (november 23, 1975 to  march 7, 1978  0 hr)
      integer*2 b7578(168)/ 21644, 21796, 21944, 22085, 22224, 22362,
     1 22498, 22631, 22762, 22895, 23030, 23168, 23311, 23458, 23607,
     2 23758, 23903, 24045, 24185, 24325, 24469, 24619, 24774, 24932,
     3 25094, 25261, 25430, 25601, 25768, 25934, 26098, 26260, 26423,
     4 26585, 26754, 26926, 27093, 27249, 27397, 27538, 27666, 27786,
     5 27897, 28004, 28113, 28223, 28341, 28462, 28584, 28705, 28825,
     6 28943, 29057, 29169, 29281, 29397, 29518, 29646, 29784, 29932,
     7 00086, 00247, 00411, 00575, 00743, 00914, 01085, 01256, 01426,
     8 01592, 01751, 01905, 02055, 02205, 02354, 02504, 02655, 02805,
     9 02952, 03096, 03238, 03375, 03514, 03653, 03792, 03931, 04067,
     a 04201, 04333, 04465, 04597, 04732, 04871, 05017, 05163, 05312,
     b 05464, 05618, 05776, 05935, 06097, 06260, 06425, 06590, 06753,
     c 06914, 07073, 07229, 07381, 07528, 07668, 07803, 07930, 08052,
     d 08168, 08279, 08384, 08484, 08580, 08674, 08767, 08859, 08950,
     e 09044, 09138, 09234, 09335, 09442, 09553, 09671, 09796, 09931,
     f 10071, 10215, 10362, 10511, 10661, 10817, 10976, 11139, 11302,
     g 11464, 11623, 11778, 11932, 12086, 12240, 12394, 12546, 12702,
     h 12861, 13021, 13183, 13345, 13507, 13666, 13823, 13979, 14132,
     i 14284, 14439, 14599, 14768, 14942, 15118, 15294, 15468, 15639/
c        tabular points from  2443580  to  2444415 (julian day numbers)
c        (march 12, 1978  to  june 24, 1980  0 hr)
      integer*2 b7880(168)/ 15806, 15970, 16136, 16306, 16478, 16654,
     1 16830, 17003, 17170, 17332, 17490, 17649, 17808, 17969, 18125,
     2 18274, 18417, 18550, 18678, 18798, 18912, 19021, 19126, 19226,
     3 19320, 19410, 19499, 19589, 19682, 19781, 19890, 20007, 20128,
     4 20252, 20376, 20502, 20627, 20753, 20883, 21018, 21157, 21300,
     5 21447, 21596, 21747, 21901, 22056, 22211, 22369, 22527, 22685,
     6 22842, 22998, 23153, 23306, 23457, 23607, 23756, 23904, 24050,
     7 24195, 24339, 24482, 24625, 24768, 24911, 25055, 25199, 25344,
     8 25489, 25635, 25782, 25929, 26077, 26226, 26377, 26530, 26683,
     9 26839, 26994, 27151, 27307, 27461, 27615, 27767, 27916, 28060,
     a 28200, 28335, 28463, 28587, 28709, 28827, 28941, 29053, 29161,
     b 29265, 29365, 29463, 29561, 29658, 29754, 29852, 29953,    55,
     c   159,   263,   369,   477,   587,   699,   816,   937,  1064,
     d  1195,  1329,  1463,  1599,  1735,  1872,  2010,  2145,  2278,
     e  2409,  2540,  2671,  2799,  2928,  3056,  3184,  3311,  3436,
     f  3562,  3687,  3814,  3939,  4064,  4189,  4311,  4432,  4552,
     g  4673,  4792,  4912,  5030,  5151,  5273,  5397,  5523,  5651,
     h  5780,  5911,  6043,  6178,  6311,  6444,  6576,  6705,  6832,
     i  6956,  7075,  7191,  7301,  7408,  7512,  7611,  7706,  7797/
c        tabular points from  2444420  to  2444515 (julian day numbers)
c        (june 29, 1980  to  october 2, 1980  0 hr)
c     integer*2 b8082( 20)/  7884,  7969,  8053,  8136,  8218,  8299,
c           rapid service values 2444520 to 2444565 (julian day numbers)
c           (october 7, 1980  to  november 21, 1980  0 hr)
      integer*2 b8082( 30)/  7884,  7969,  8053,  8136,  8218,  8299,
     1  8380,  8460,  8541,  8623,  8708,  8798,  8893,  8993,  9099,
     2  9209,  9324,  9442,  9565,  9691,
     3  9820,  9945, 10074, 10210, 10355, 10495, 10633, 10770, 10910,
     4 11039/
 
      equivalence (iau, b6971), (iau(169), b7173),
     .            (iau(337), b7375), (iau(505), b7578),
     .            (iau(673), b7880), (iau(841), b8082)
c
c$$$$$ extend table when routine revised from more bih values received
c
c
c$$$  julian day number of given calendar date =
c$$$                   = julian date at midnight beginning of day + 0.5
c$$$                   = mjd + 2400001 (mjd=usno modified julian date)
c
c     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
c
c         can not calculate a1ut1 before january 3,1969 using bih values
      if(jd.lt.2440225) call SUICID(
     .'  CAN NOT CALCULATE A1UT1 BEFORE JANUARY 3,1969, STOP IN BIHUT1 '
     ., 16)
c
c extrapolation beyond table
c$$$$$ date to be extended when routine revised
c test on final jd - 5  of final bih values
      if(jd.ge.2444510) then
 
c test on final jd - 5  of rapid service values
         if(jd.ge.2444560) then
            if(.not.nxtrp) then
               write(Iout, 10) jd
   10          format(i17,
     .' WARNING:  A1-UT1 BEING EXTRAPOLATED BEYOND END OF BIH TABLE ***'
     .)
               Line  = Line + 1
               nxtrp = .true.
            endif
            BIHUT1 = (ETUTF(jd,frw) - 32.15_10) + UT2UT1(jd, frw)
            return
 
c warning message for use of rapid service values
         else if(.not.lxtrp) then
            write(Iout, 20) jd
   20       format(i17,
     . ' WARNING:  A1-UT1 INTERPOLATION USING RAPID SERVICE VALUES ***'
     . )
            Line  = Line + 1
            lxtrp = .true.
         endif
      endif
c
c calculate interpolation times and value of tab. points
      t   = jd - 2440220
      t   = (t + frw)/5._10
      nnint = int(t, int32)
      t   = t - nnint
      s   = 1._10 - t
      nnint = nnint - 1
      if(int.ne.intsav) then
         do i = 1, 4
            j = nnint + i
            xint(i) = iau(j) + 60000._10
            if(j.ge.int1) xint(i) = xint(i) + 30000._10
            if(j.ge.int2) xint(i) = xint(i) + 30000._10
            if(j.ge.int3) xint(i) = xint(i) + 30000._10
            if(j.ge.int4) xint(i) = xint(i) + 30000._10
 
c the integer*2 table is modulo 30000
         end do
c
c calculate interpolation y-vector
         do i = 1, 2
            nr    = i + 1
            f2    = 0.166666666666666666667_10*(xint(nr+1)+xint(nr-1))
            y1(i) = 1.33333333333333333333_10*xint(nr) - f2
            y2(i) = -0.33333333333333333333_10*xint(nr) + f2
         end do
         intsav = int
      endif
c
c second difference interpolation
      BIHUT1 = (t*(y1(2)+t*t*y2(2)) + s*(y1(1)+s*s*y2(1)))*1E-4_10
c
c           iat-a1= -0.03439 sec.
c        or iat= a1 - 0.03439 sec.
c           tabulated values example  iat-ut1= 7.0123
c           want  a1-ut1   so  a1-0.03439-ut1= 7.0123
c                          or a1-ut1= 7.0123  +  0.03439
c           ref  page 42  technical note 1972-5  by m.e.ash  04/19/72
c           determination of earth satellite orbits
      BIHUT1 = BIHUT1 + 0.03439_10
c
c add fortnightly and monthly terms due to tidal effects
c which have been removed by bih smoothing
c ref:  woolard  astron.j. 64,140-142, 1959
      if(Jct(28).gt.1) then
         tjd = jd + (frw - 0.5_10)
 
c get angles in brown lunar theory (units are revolutions)
         call FUNARG(tjd)
         BIHUT1 = BIHUT1 + k2*(2.47_10*SIN(ARGMNT(2._10*F+2._10*Ascm))
     .            + 1.02_10*SIN(ARGMNT(2._10*F+Ascm))
     .            + 2.63_10*SIN(ARGMNT(L))
     .            + 0.58_10*SIN(ARGMNT(2._10*D-L)))*1E-3_10
      endif
c
c analytical model terms added to bihut1 in function a1ut1
c
      return
      end
