
      real*10 function A1UT1(jd, fract)

      USE ISO_FORTRAN_ENV, ONLY: INT32
 
      implicit none
 
c
c amuchastegui/ash - aug 1969 - real*8 function a1ut1
c
c arguments
      real*10 fract
      integer*4 jd
c
c        determine a1-ut1 time from 1956 to the present.  the source is
c        controlled by jct(33):
c           jct(33)=-1  use usno values tabulated in this routine
c                  = 0  (default) after 3 jan 1969 use bih values
c                       tabulated in subroutine bihut1;  before 3 jan
c                       1969 use usno values
c                 .gt.0 read A.1-UT1 and wobble tables from data sets
c                       JCT(33) and JCT(33)+1, respectively.
c
c$$$$$period of validity to be extended when routine revised
c        second difference interpolation from 10 days interval final
c        table.  call xa1ut1 to go beyond final table.
c
c common
      include 'fcntrl.inc'
      include 'inodta.inc'

c local
      real*10 t,xint(4),y1(2),y2(2),s,f2
      data int1, int2/299, 434/
      data int3, int4/548, 648/
      integer*2 iau(700)
      integer*4 i,nnint,int1,int2,int3,int4,j,nr

c external functions
      real*10 A1UT1F,BIHUT1,XA1UT1
c
c     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
c
c        a1ut1 at ten days interval
c
c        tabular points from  2435480 to  2437150 (julian day numbers)
c        (january 7,1956 to august 3,1960, 0 hr)
      integer*2 a5660(168)/ -8013, -7977, -7930, -7844, -7749, -7574,
     1 -7496, -7333, -7187, -7091, -6936, -6902, -6821, -6627, -6543,
     2 -6455, -6363, -6363, -6305, -6250, -6290, -6229, -6165, -6145,
     3 -6058, -6003, -6003, -5913, -5801, -5700, -5588, -5458, -5314,
     4 -5128, -5027, -4900, -4728, -4580, -4510, -4464, -4277, -4149,
     5 -4031, -3862, -3681, -3561, -3386, -3243, -3063, -2882, -2697,
     6 -2563, -2428, -2391, -2277, -2198, -2139, -2056, -1968, -2013,
     7 -1891, -1829, -1671, -1476, -1350, -1152,  -985,  -834,  -669,
     8  -460,  -291,   -88,    71,   266,   478,   651,   795,   949,
     9  1092,  1279,  1461,  1609,  1803,  2015,  2156,  2359,  2530,
     a  2700,  2778,  2916,  2996,  3016,  3109,  3220,  3271,  3303,
     b  3389,  3428,  3508,  3660,  3753,  3881,  4130,  4291,  4391,
     c  4540,  4750,  4916,  5106,  5209,  5416,  5561,  5707,  5833,
     d  6012,  6181,  6320,  6431,  6585,  6711,  6883,  7039,  7144,
     e  7248,  7387,  7538,  7600,  7689,  7748,  7800,  7867,  7997,
     f  8030,  8110,  8229,  8347,  8476,  8586,  8800,  8987,  9156,
     g  9320,  9457,  9626,  9773,  9912, 10070, 10269, 10371, 10498,
     h 10595, 10756, 10943, 11162, 11321, 11437, 11509, 11714, 11908,
     i 12057, 12182, 12270, 12369, 12415, 12502, 12566, 12525, 12544/
c
c        tabular points from  2437160 to 2438830 (julian day numbers)
c        (august 13,1960 to march 10,1965, 0 hr)
      integer*2 a6065(168)/ 12616, 12694, 12752, 12862, 12952, 13113,
     1 13243, 13331, 13454, 13617, 13775, 13925, 14098, 14227, 14315,
     2 14470, 14616, 14686, 14742, 14823, 14966, 15158, 15352, 15550,
     3 15694, 15770, 15837, 15992, 16150, 16254, 16390, 16470, 16516,
     4 16583, 16593, 16693, 16726, 16782, 16915, 16993, 17071, 17143,
     5 17240, 17378, 17518, 17628, 17767, 17972, 18069, 18196, 18368,
     6 18497, 18587, 18691, 18854, 18981, 19088, 19283, 19469, 19612,
     7 19735, 19910, 20083, 20267, 20429, 20583, 20690, 20794, 20828,
     8 20891, 20944, 20961, 21066, 21120, 21185, 21283, 21427, 21580,
     9 21697, 21821, 22002, 22177, 22347, 22502, 22654, 22884, 23021,
     a 23183, 23352, 23391, 23505, 23649, 23786, 23851, 23977, 24175,
     b 24378, 24597, 24745, 24947, 25120, 25268, 25435, 25572, 25671,
     c 25791, 25870, 25897, 25984, 26104, 26202, 26314, 26527, 26652,
     d 26765, 26916, 27190, 27390, 27606, 27769, 27978, 28263, 28484,
     e 28647, 28866, 29061, 29268, 29505, 29709, 29887,    87,   328,
     f   589,   813,   954,  1208,  1446,  1710,  1889,  2112,  2282,
     g  2395,  2532,  2617,  2686,  2848,  2989,  3077,  3178,  3359,
     h  3541,  3734,  4019,  4250,  4449,  4659,  4870,  5078,  5289,
     i  5531,  5793,  5999,  6199,  6393,  6633,  6841,  7049,  7303/
c
c        tabular points from  2438840  to  2440510 (julian day numbers)
c        (march 20,1965 to october 15, 1969, 0 hr)
      integer*2 a6569(168)/  7567,  7852,  8143,  8443,  8603,  8862,
     1  9088,  9274,  9512,  9709,  9873, 10039, 10202, 10342, 10492,
     2 10623, 10859, 11045, 11251, 11472, 11717, 11997, 12287, 12500,
     3 12790, 13071, 13339, 13566, 13747, 13949, 14170, 14448, 14709,
     4 14976, 15210, 15418, 15661, 15934, 16259, 16500, 16743, 17027,
     5 17330, 17645, 17880, 18082, 18312, 18495, 18629, 18785, 18963,
     6 19110, 19312, 19546, 19756, 20036, 20265, 20529, 20861, 21140,
     7 21418, 21692, 21994, 22207, 22489, 22696, 22896, 23098, 23414,
     8 23669, 23919, 24201, 24459, 24732, 24989, 25328, 25608, 25847,
     9 26153, 26442, 26700, 26882, 27045, 27214, 27391, 27573, 27740,
     a 27890, 28055, 28246, 28469, 28668, 28835, 29037, 29320, 29632,
     b 29905,   224,   501,   646,   933,  1207,  1473,  1754,  2028,
     c  2298,  2582,  2840,  3058,  3293,  3592,  3865,  4208,  4525,
     d  4747,  5012,  5281,  5518,  5740,  5916,  6082,  6263,  6440,
     e  6621,  6839,  7089,  7333,  7569,  7780,  8021,  8196,  8463,
     f  8834,  9112,  9330,  9607,  9925, 10181, 10432, 10686, 10982,
     g 11213, 11479, 11739, 12027, 12330, 12699, 12990, 13271, 13630,
     h 13996, 14252, 14484, 14806, 15114, 15305, 15463, 15700, 15888,
     i 16031, 16268, 16445, 16689, 16928, 17159, 17452, 17782, 18046/
c
c        tabular points from  2440520  to  2442190 (julian day numbers)
c        (october 25, 1969 to    may 22, 1974   0 hr)
      integer*2 a6974(168)/ 18349, 18647, 18887, 19198, 19450, 19764,
     1 20038, 20317, 20650, 20940, 21206, 21516, 21848, 22193, 22486,
     2 22763, 23096, 23447, 23752, 24102, 24382, 24676, 24905, 25155,
     3 25395, 25607, 25773, 25960, 26153, 26337, 26569, 26745, 26951,
     4 27201, 27478, 27706, 27961, 28262, 28635, 28935, 29218, 29519,
     5 29809,    58,   340,   633,   859,  1139,  1403,  1674,  1942,
     6  2254,  2594,  2950,  3253,  3573,  3900,  4213,  4524,  4785,
     7  5045,  5277,  5392,  5676,  5962,  6207,  6457,  6667,  6896,
     8  7147,  7463,  7801,  8156,  8493,  8861,  9244,  9596,  9952,
     9 10258, 10542, 10796, 11109, 11379, 11755, 12093, 12411, 12733,
     a 13149, 13518, 13849, 14161, 14510, 14852, 15243, 15652, 15930,
     b 16191, 16463, 16685, 16983, 17165, 17404, 17686, 17960, 18188,
     c 18463, 18725, 19066, 19417, 19739, 20058, 20376, 20706, 21044,
     d 21355, 21719, 22061, 22361, 22657, 22974, 23316, 23687, 24019,
     e 24340, 24678, 25063, 25432, 25800, 26156, 26471, 26829, 27129,
     f 27399, 27679, 27933, 28198, 28427, 28672, 28905, 29152, 29421,
     g 29680, 29941,   208,   525,   840,  1146,  1521,  1831,  2152,
     h  2441,  2772,  3082,  3322,  3583,  3824,  4099,  4372,  4643,
     i  4948,  5317,  5611,  5915,  6227,  6570,  6926,  7190,  7520/
c
c        tabular points from  2442200  to  2442470 (julian day numbers)
c        (june 1, 1974     to  february 26, 1975    0 hr)
      integer*2 a7475( 28)/  7839,  8085,  8311,  8469,  8664,  8862,
     1  9033,  9238,  9493,  9668,  9893, 10177, 10462, 10765, 11087,
     2 11358, 11657, 12003, 12293, 12617, 12877, 13143, 13395, 13693,
     3 14004, 14360, 14627, 14887/
 
      equivalence (iau, a5660), (iau(169), a6065),
     .            (iau(337), a6569), (iau(505), a6974),
     .            (iau(673), a7475)
 
c$$$$$ extend table when routine revised from usno time cards
 
c$$$  julian day number of given calendar date =
c$$$                   = julian date at midnight beginning of day + 0.5
c$$$                   = mjd + 2400001 (mjd=usno modified julian date)
c
c     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
c
c         can not calculate a1ut1 before january 17, 1956
      if(jd.lt.2435490) call SUICID(
     .'  CAN NOT CALCULATE A1UT1 BEFORE JANUARY 17,1956, STOP IN A1UT1 '
     ., 16)
 
      if(Jct(33).ge.0) then
         if(jd.ge.2440225) then
            if(Jct(33).gt.0) then
 
c if jct(33)>0, use values from table
               call UT1RED(jd, fract, A1UT1)
            else
               A1UT1 = BIHUT1(jd, fract)
            endif
            goto 100
         endif
      endif
c
c extrapolation beyond table
c$$$$$ date to be extended when routine revised
      if(jd.lt.2442460) then
c
c calculate interpolation times and value of tab. points
         t   = jd - 2435480
         t   = (t + fract)/10._10
         nnint = INT(t,INT32)
         t   = t - nnint
         nnint = nnint - 1
         do i = 1, 4
            j = nnint + i
            xint(i) = iau(j)
            if(j.ge.int1) xint(i) = xint(i) + 30000._10
            if(j.ge.int2) xint(i) = xint(i) + 30000._10
            if(j.ge.int3) xint(i) = xint(i) + 30000._10
            if(j.ge.int4) xint(i) = xint(i) + 30000._10
 
c the integer*2 table is modulo 30000
         end do
c
c calculate interpolation y-vector
         s = 1._10 - t
         do i = 1, 2
            nr    = i + 1
            f2    = 0.166666666666666666667_10*(xint(nr+1)+xint(nr-1))
            y1(i) = 1.33333333333333333333_10*xint(nr) - f2
            y2(i) = -0.33333333333333333333_10*xint(nr) + f2
         end do
c
c second difference interpolation
         A1UT1 = (t*(y1(2)+t*t*y2(2)) + s*(y1(1)+s*s*y2(1)))*1.E-04_10
      else
         A1UT1 = XA1UT1(jd, fract)
      endif
c
c add analytic model terms to a1-ut1
  100 s = A1UT1F(jd, fract)
      A1UT1 = A1UT1 + s
      if(mod(Jct(6)/8192,2).eq.1) then
         if(Line.gt.56) call OBSPAG
         write(Iout,870) jd,fract,A1UT1,s
  870    format(' A1UT1: JD.F=',i8,f13.12,f13.8,' MODEL=',f11.8)
         Line = Line+1
      endif
 
      return
      end
